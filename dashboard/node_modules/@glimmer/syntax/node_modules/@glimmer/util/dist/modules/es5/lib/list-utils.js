function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

import { WILL_DROP, DID_DROP, destructor, CHILDREN } from './lifetimes';
export var ListNode = function ListNode(value) {
  this.next = null;
  this.prev = null;
  this.value = value;
};
export var LinkedList =
/*#__PURE__*/
function () {
  function LinkedList() {
    this.clear();
  }

  var _proto = LinkedList.prototype;

  _proto.head = function head() {
    return this._head;
  };

  _proto.tail = function tail() {
    return this._tail;
  };

  _proto.clear = function clear() {
    this._head = this._tail = null;
  };

  _proto.toArray = function toArray() {
    var out = [];
    this.forEachNode(function (n) {
      return out.push(n);
    });
    return out;
  };

  _proto.nextNode = function nextNode(node) {
    return node.next;
  };

  _proto.forEachNode = function forEachNode(callback) {
    var node = this._head;

    while (node !== null) {
      callback(node);
      node = node.next;
    }
  };

  _proto.insertBefore = function insertBefore(node, reference) {
    if (reference === void 0) {
      reference = null;
    }

    if (reference === null) return this.append(node);
    if (reference.prev) reference.prev.next = node;else this._head = node;
    node.prev = reference.prev;
    node.next = reference;
    reference.prev = node;
    return node;
  };

  _proto.append = function append(node) {
    var tail = this._tail;

    if (tail) {
      tail.next = node;
      node.prev = tail;
      node.next = null;
    } else {
      this._head = node;
    }

    return this._tail = node;
  };

  _proto.remove = function remove(node) {
    if (node.prev) node.prev.next = node.next;else this._head = node.next;
    if (node.next) node.next.prev = node.prev;else this._tail = node.prev;
    return node;
  };

  _proto[WILL_DROP] = function () {
    this.forEachNode(function (d) {
      return destructor(d)[WILL_DROP]();
    });
  };

  _proto[DID_DROP] = function () {
    this.forEachNode(function (d) {
      return destructor(d)[DID_DROP]();
    });
  };

  _createClass(LinkedList, [{
    key: CHILDREN,
    get: function get() {
      var out = [];
      this.forEachNode(function (d) {
        return out.push.apply(out, destructor(d)[CHILDREN]);
      });
      return out;
    }
  }]);

  return LinkedList;
}();
export var ListSlice =
/*#__PURE__*/
function () {
  function ListSlice(head, tail) {
    this._head = head;
    this._tail = tail;
  }

  var _proto2 = ListSlice.prototype;

  _proto2.forEachNode = function forEachNode(callback) {
    var node = this._head;

    while (node !== null) {
      callback(node);
      node = this.nextNode(node);
    }
  };

  _proto2.head = function head() {
    return this._head;
  };

  _proto2.tail = function tail() {
    return this._tail;
  };

  _proto2.toArray = function toArray() {
    var out = [];
    this.forEachNode(function (n) {
      return out.push(n);
    });
    return out;
  };

  _proto2.nextNode = function nextNode(node) {
    if (node === this._tail) return null;
    return node.next;
  };

  return ListSlice;
}();
export var EMPTY_SLICE = new ListSlice(null, null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3V0aWwvbGliL2xpc3QtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLFNBQUEsU0FBQSxFQUFBLFFBQUEsRUFBQSxVQUFBLEVBQUEsUUFBQSxRQUFBLGFBQUE7QUFRQSxXQUFNLFFBQU4sR0FLRSxrQkFBQSxLQUFBLEVBQW9CO0FBSmIsT0FBQSxJQUFBLEdBQUEsSUFBQTtBQUNBLE9BQUEsSUFBQSxHQUFBLElBQUE7QUFJTCxPQUFBLEtBQUEsR0FBQSxLQUFBO0FBQ0QsQ0FQSDtBQWNBLFdBQU0sVUFBTjtBQUFBO0FBQUE7QUFJRSx3QkFBQTtBQUNFLFNBQUEsS0FBQTtBQUNEOztBQU5IOztBQUFBLFNBUUUsSUFSRixHQVFFLGdCQUFJO0FBQ0YsV0FBTyxLQUFQLEtBQUE7QUFDRCxHQVZIOztBQUFBLFNBWUUsSUFaRixHQVlFLGdCQUFJO0FBQ0YsV0FBTyxLQUFQLEtBQUE7QUFDRCxHQWRIOztBQUFBLFNBZ0JFLEtBaEJGLEdBZ0JFLGlCQUFLO0FBQ0gsU0FBQSxLQUFBLEdBQWEsS0FBQSxLQUFBLEdBQWIsSUFBQTtBQUNELEdBbEJIOztBQUFBLFNBb0JFLE9BcEJGLEdBb0JFLG1CQUFPO0FBQ0wsUUFBSSxHQUFHLEdBQVAsRUFBQTtBQUNBLFNBQUEsV0FBQSxDQUFpQixVQUFBLENBQUM7QUFBQSxhQUFJLEdBQUcsQ0FBSCxJQUFBLENBQXRCLENBQXNCLENBQUo7QUFBQSxLQUFsQjtBQUNBLFdBQUEsR0FBQTtBQUNELEdBeEJIOztBQUFBLFNBMEJFLFFBMUJGLEdBMEJFLGtCQUFRLElBQVIsRUFBZ0I7QUFDZCxXQUFPLElBQUksQ0FBWCxJQUFBO0FBQ0QsR0E1Qkg7O0FBQUEsU0E4QkUsV0E5QkYsR0E4QkUscUJBQVcsUUFBWCxFQUF1QztBQUNyQyxRQUFJLElBQUksR0FBRyxLQUFYLEtBQUE7O0FBRUEsV0FBTyxJQUFJLEtBQVgsSUFBQSxFQUFzQjtBQUNwQixNQUFBLFFB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TUFBQSxJQUFJLEdBQUcsS0FBQSxRQUFBLENBQVAsSUFBTyxDQUFQO0FBQ0Q7QUFDRixHQWhCSDs7QUFBQSxVQWtCRSxJQWxCRixHQWtCRSxnQkFBSTtBQUNGLFdBQU8sS0FBUCxLQUFBO0FBQ0QsR0FwQkg7O0FBQUEsVUFzQkUsSUF0QkYsR0FzQkUsZ0JBQUk7QUFDRixXQUFPLEtBQVAsS0FBQTtBQUNELEdBeEJIOztBQUFBLFVBMEJFLE9BMUJGLEdBMEJFLG1CQUFPO0FBQ0wsUUFBSSxHQUFHLEdBQVAsRUFBQTtBQUNBLFNBQUEsV0FBQSxDQUFpQixVQUFBLENBQUM7QUFBQSxhQUFJLEdBQUcsQ0FBSCxJQUFBLENBQXRCLENBQXNCLENBQUo7QUFBQSxLQUFsQjtBQUNBLFdBQUEsR0FBQTtBQUNELEdBOUJIOztBQUFBLFVBZ0NFLFFBaENGLEdBZ0NFLGtCQUFRLElBQVIsRUFBZ0I7QUFDZCxRQUFJLElBQUksS0FBSyxLQUFiLEtBQUEsRUFBeUIsT0FBQSxJQUFBO0FBQ3pCLFdBQU8sSUFBSSxDQUFYLElBQUE7QUFDRCxHQW5DSDs7QUFBQTtBQUFBO0FBc0NBLE9BQU8sSUFBTSxXQUFXLEdBQUcsSUFBQSxTQUFBLENBQUEsSUFBQSxFQUFwQixJQUFvQixDQUFwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wdGlvbiB9IGZyb20gJy4vcGxhdGZvcm0tdXRpbHMnO1xuaW1wb3J0IHsgV0lMTF9EUk9QLCBESURfRFJPUCwgZGVzdHJ1Y3RvciwgQ0hJTERSRU4gfSBmcm9tICcuL2xpZmV0aW1lcyc7XG5pbXBvcnQgeyBEcm9wIH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGlua2VkTGlzdE5vZGUge1xuICBuZXh0OiBPcHRpb248TGlua2VkTGlzdE5vZGU+O1xuICBwcmV2OiBPcHRpb248TGlua2VkTGlzdE5vZGU+O1xufVxuXG5leHBvcnQgY2xhc3MgTGlzdE5vZGU8VD4gaW1wbGVtZW50cyBMaW5rZWRMaXN0Tm9kZSB7XG4gIHB1YmxpYyBuZXh0OiBPcHRpb248TGlzdE5vZGU8VD4+ID0gbnVsbDtcbiAgcHVibGljIHByZXY6IE9wdGlvbjxMaXN0Tm9kZTxUPj4gPSBudWxsO1xuICBwdWJsaWMgdmFsdWU6IFQ7XG5cbiAgY29uc3RydWN0b3IodmFsdWU6IFQpIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gIH1cbn1cblxuLy8gd2UgYXJlIHVuYWJsZSB0byBleHByZXNzIHRoZSBjb25zdHJhaW50IHRoYXQgVCdzIC5wcmV2IGFuZCAubmV4dCBhcmVcbi8vIHRoZW1zZWx2ZXMgVC4gSG93ZXZlciwgaXQgd2lsbCBhbHdheXMgYmUgdHJ1ZSwgc28gdHJ1c3QgdXMuXG50eXBlIHRydXN0ID0gYW55O1xuXG5leHBvcnQgY2xhc3MgTGlua2VkTGlzdDxUIGV4dGVuZHMgTGlua2VkTGlzdE5vZGU+IGltcGxlbWVudHMgU2xpY2U8VD4sIERyb3Age1xuICBwcml2YXRlIF9oZWFkITogT3B0aW9uPFQ+O1xuICBwcml2YXRlIF90YWlsITogT3B0aW9uPFQ+O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgfVxuXG4gIGhlYWQoKTogT3B0aW9uPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5faGVhZDtcbiAgfVxuXG4gIHRhaWwoKTogT3B0aW9uPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5fdGFpbDtcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIHRoaXMuX2hlYWQgPSB0aGlzLl90YWlsID0gbnVsbDtcbiAgfVxuXG4gIHRvQXJyYXkoKTogVFtdIHtcbiAgICBsZXQgb3V0OiBUW10gPSBbXTtcbiAgICB0aGlzLmZvckVhY2hOb2RlKG4gPT4gb3V0LnB1c2gobikpO1xuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBuZXh0Tm9kZShub2RlOiBUKTogVCB7XG4gICAgcmV0dXJuIG5vZGUubmV4dCBhcyB0cnVzdDtcbiAgfVxuXG4gIGZvckVhY2hOb2RlKGNhbGxiYWNrOiAobm9kZTogVCkgPT4gdm9pZCkge1xuICAgIGxldCBub2RlID0gdGhpcy5faGVhZDtcblxuICAgIHdoaWxlIChub2RlICE9PSBudWxsKSB7XG4gICAgICBjYWxsYmFjayhub2RlIGFzIHRydXN0KTtcbiAgICAgIG5vZGUgPSBub2RlLm5leHQgYXMgdHJ1c3Q7XG4gICAgfVxuICB9XG5cbiAgaW5zZXJ0QmVmb3JlKG5vZGU6IFQsIHJlZmVyZW5jZTogT3B0aW9uPFQ+ID0gbnVsbCk6IFQge1xuICAgIGlmIChyZWZlcmVuY2UgPT09IG51bGwpIHJldHVybiB0aGlzLmFwcGVuZChub2RlKTtcblxuICAgIGlmIChyZWZlcmVuY2UucHJldikgcmVmZXJlbmNlLnByZXYubmV4dCA9IG5vZGU7XG4gICAgZWxzZSB0aGlzLl9oZWFkID0gbm9kZTtcblxuICAgIG5vZGUucHJldiA9IHJlZmVyZW5jZS5wcmV2O1xuICAgIG5vZGUubmV4dCA9IHJlZmVyZW5jZTtcbiAgICByZWZlcmVuY2UucHJldiA9IG5vZGU7XG5cbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGFwcGVuZChub2RlOiBUKTogVCB7XG4gICAgbGV0IHRhaWwgPSB0aGlzLl90YWlsO1xuXG4gICAgaWYgKHRhaWwpIHtcbiAgICAgIHRhaWwubmV4dCA9IG5vZGU7XG4gICAgICBub2RlLnByZXYgPSB0YWlsO1xuICAgICAgbm9kZS5uZXh0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGVhZCA9IG5vZGU7XG4gICAgfVxuXG4gICAgcmV0dXJuICh0aGlzLl90YWlsID0gbm9kZSk7XG4gIH1cblxuICByZW1vdmUobm9kZTogVCk6IFQge1xuICAgIGlmIChub2RlLnByZXYpIG5vZGUucHJldi5uZXh0ID0gbm9kZS5uZXh0O1xuICAgIGVsc2UgdGhpcy5faGVhZCA9IG5vZGUubmV4dCBhcyB0cnVzdDtcblxuICAgIGlmIChub2RlLm5leHQpIG5vZGUubmV4dC5wcmV2ID0gbm9kZS5wcmV2O1xuICAgIGVsc2UgdGhpcy5fdGFpbCA9IG5vZGUucHJldiBhcyB0cnVzdDtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgW1dJTExfRFJPUF0oKSB7XG4gICAgdGhpcy5mb3JFYWNoTm9kZShkID0+IGRlc3RydWN0b3IoZClbV0lMTF9EUk9QXSgpKTtcbiAgfVxuXG4gIFtESURfRFJPUF0oKSB7XG4gICAgdGhpcy5mb3JFYWNoTm9kZShkID0+IGRlc3RydWN0b3IoZClbRElEX0RST1BdKCkpO1xuICB9XG5cbiAgZ2V0IFtDSElMRFJFTl0oKTogSXRlcmFibGU8RHJvcD4ge1xuICAgIGxldCBvdXQ6IERyb3BbXSA9IFtdO1xuICAgIHRoaXMuZm9yRWFjaE5vZGUoZCA9PiBvdXQucHVzaCguLi5kZXN0cnVjdG9yKGQpW0NISUxEUkVOXSkpO1xuICAgIHJldHVybiBvdXQ7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBTbGljZTxUIGV4dGVuZHMgTGlua2VkTGlzdE5vZGU+IHtcbiAgaGVhZCgpOiBPcHRpb248VD47XG4gIHRhaWwoKTogT3B0aW9uPFQ+O1xuICBuZXh0Tm9kZShub2RlOiBUKTogT3B0aW9uPFQ+O1xuICBmb3JFYWNoTm9kZShjYWxsYmFjazogKG5vZGU6IFQpID0+IHZvaWQpOiB2b2lkO1xuICB0b0FycmF5KCk6IFRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDbG9uZWFibGVMaXN0Tm9kZSBleHRlbmRzIExpbmtlZExpc3ROb2RlIHtcbiAgY2xvbmUoKTogdGhpcztcbn1cblxuZXhwb3J0IGNsYXNzIExpc3RTbGljZTxUIGV4dGVuZHMgTGlua2VkTGlzdE5vZGU+IGltcGxlbWVudHMgU2xpY2U8VD4ge1xuICBwcml2YXRlIF9oZWFkOiBPcHRpb248VD47XG4gIHByaXZhdGUgX3RhaWw6IE9wdGlvbjxUPjtcblxuICBjb25zdHJ1Y3RvcihoZWFkOiBPcHRpb248VD4sIHRhaWw6IE9wdGlvbjxUPikge1xuICAgIHRoaXMuX2hlYWQgPSBoZWFkO1xuICAgIHRoaXMuX3RhaWwgPSB0YWlsO1xuICB9XG5cbiAgZm9yRWFjaE5vZGUoY2FsbGJhY2s6IChub2RlOiBUKSA9PiB2b2lkKSB7XG4gICAgbGV0IG5vZGUgPSB0aGlzLl9oZWFkO1xuXG4gICAgd2hpbGUgKG5vZGUgIT09IG51bGwpIHtcbiAgICAgIGNhbGxiYWNrKG5vZGUpO1xuICAgICAgbm9kZSA9IHRoaXMubmV4dE5vZGUobm9kZSk7XG4gICAgfVxuICB9XG5cbiAgaGVhZCgpOiBPcHRpb248VD4ge1xuICAgIHJldHVybiB0aGlzLl9oZWFkO1xuICB9XG5cbiAgdGFpbCgpOiBPcHRpb248VD4ge1xuICAgIHJldHVybiB0aGlzLl90YWlsO1xuICB9XG5cbiAgdG9BcnJheSgpOiBUW10ge1xuICAgIGxldCBvdXQ6IFRbXSA9IFtdO1xuICAgIHRoaXMuZm9yRWFjaE5vZGUobiA9PiBvdXQucHVzaChuKSk7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIG5leHROb2RlKG5vZGU6IFQpOiBPcHRpb248VD4ge1xuICAgIGlmIChub2RlID09PSB0aGlzLl90YWlsKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gbm9kZS5uZXh0IGFzIFQ7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IEVNUFRZX1NMSUNFID0gbmV3IExpc3RTbGljZShudWxsLCBudWxsKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=